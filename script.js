const i18n = {
  en: {
    // Nav
    navTimeline: "Timeline",
    navHelp: "Help",
    // Hero
    heroTitle1: "Stand With The People of",
    heroTitle2: "Iran",
    heroFreedom: "For Freedom",
    heroStatLabel: "civilians killed in less than 3 days",
    heroQuote: "This is not a political conflict. It is state violence against civilians.",
    scrollText: "Scroll",
    // Iran & Its People
    iranLabel: "Who We Are",
    iranTitle: "Iran and Its People",
    iranP1: "Iran, formerly known as Persia, is the world's oldest continuous civilization linked to a modern state, with over 5,000 years of history. Home to more than 90 million people, Iran has shaped human history through its rich culture — expressed in timeless poetry, music, art, and philosophy — leaving a lasting imprint on global civilization.",
    iranP2: "Persian people are widely known for their deep sense of hospitality, warmth, and generosity. They are commonly associated with a peaceful, patient, and respectful way of life, valuing dialogue, courtesy, and human connection.",
    hospitalityTitle: "A Legacy of Compassion",
    hospitalityP: "One powerful example of the Iranian people's humanity is welcoming approximately 116,000–120,000 Polish refugees during World War II. They arrived in Iran and were sheltered and cared for with compassion and dignity.",
    hospitalityCaption: "Polish refugees in Iran, 1942",
    // Regime
    regimeLabel: "The Truth",
    regimeTitle1: "Islamic Republic",
    regimeNe: "≠",
    regimeTitle2: "Iran",
    regimeP: "While Iranians aspire to peace and respect for human life, the government (Islamic Regime) does not represent these values. It is a brutal and authoritarian regime that is built on extreme ideology to justify corruption and suppress the will of its people.",
    regimeFact1: "Rules through fear — using executions, torture, and censorship to silence dissent and crush basic freedoms",
    regimeFact2: "Systematically targets women, minorities, and activists",
    regimeFact3: "Exports instability and violence through proxy militias and extremist networks",
    regimeFact4: "The policies of this regime do not represent the culture, values, or character of its people",
    // Diaspora
    diasporaLabel: "Bridges Between Nations",
    diasporaTitle: "Iranian Diaspora & Canada",
    diasporaP1: "The Iranian diaspora in Canada has grown through several waves of immigration, shaped by political, social, and economic events. Many Iranians arrived as students, skilled professionals, entrepreneurs, and refugees, contributing extensively to fields such as engineering, medicine, academia, business, and the arts.",
    diasporaP2: "Today, the Iranian-Canadian community is among the most educated and civically engaged diaspora groups, deeply integrated into Canadian society. Iranians in Québec speak Persian (Farsi) alongside French and English, contributing to Québec's cultural, academic, and economic life while proudly preserving their vibrant cultural identity.",
    canadaTitle: "Iran-Canada Relationship",
    canadaP1: "Before the establishment of the Islamic Republic, Iran–Canada relations were friendly, stable, and constructive. A notable moment was the official visit of Mohammad Reza Shah Pahlavi, the King of Iran, to Canada and Québec in 1965.",
    canadaP2: "Relations deteriorated after 1979. Canada formally severed diplomatic relations with Iran in 2012, citing serious concerns over human rights abuses and support for terrorism.",
    canadaCaption: "The Shah of Iran and his wife visiting Montreal, 1965. Source: Les Archives de la Ville de Montréal",
    futureVision: "A free and democratic Iran can rebuild its strong historic relationship with Canada and unlock many positive opportunities, including expanded trade and investment in technology, agriculture, and industry, as well as the growth of tourism and cultural exchange.",
    futureTitle: "A Vision for the Future",
    // Timeline
    timelineLabel: "History of Resistance",
    timelineTitle: "Four Decades of Protest and Repression in Iran",
    timelineIntro: "For more than 47 years, Iranians have endured the Islamic regime while persistently and peacefully fighting for their fundamental rights.",
    // Timeline events
    t1979Title: "Women's Protests Against Mandatory Hijab",
    t1979D1: "First major protest against Islamic Republic policies",
    t1979D2: "Women protest compulsory hijab",
    t1979D3: "State response: repression and rollback of women's rights",
    t1980Title: "Mass Executions of Political Prisoners",
    t1980D1: "Years of arrests, executions, political purges (1980–88)",
    t1980D2: "Thousands executed in secret",
    t1980D3: "\"3-minute courts,\" no fair trials",
    t1980Death: "Death toll: over 5,000",
    t1980Memorial: "Classified as crimes against humanity by Human Rights Watch",
    t1999Title: "Student Movement",
    t1999D1: "Protests against restrictions on freedom of expression and press censorship",
    t1999D2: "Violent attack on university dorms",
    t1999D3: "Start of direct repression against students and youth",
    t2009Title: "Green Movement",
    t2009D1: "Mass protests after disputed presidential election",
    t2009D2: "Millions marched nationwide for peaceful protest",
    t2009D3: "State response: repression, arrests, killings",
    t2009D4: "Unrest continued for over a year",
    t2017Title: "Economic Protests Turning Political",
    t2017D1: "Protests over economic grievances",
    t2017D2: "Quickly became anti-regime",
    t2017D3: "State response: extreme violence & repression",
    t2019Title: "Bloody November",
    t2019D1: "Protests over fuel price increases",
    t2019D2: "Brutally suppressed by the state",
    t2019D3: "At least 1,500 killed in days",
    t2019D4: "Deepened the divide between people and the regime",
    t2019Death: "At least 1,500 killed",
    t2020Title: "Downing of Flight PS752",
    t2020D1: "IRGC shoots down Ukraine International Airlines Flight PS752",
    t2020D2: "176 civilians killed (55 Canadians, 30 Permanent Residents)",
    t2020D3: "Protests over state lies and impunity",
    t2020D4: "State response: Arrests, intimidation, repression",
    t2020Death: "176 civilians killed",
    t2022Title: "Woman, Life, Freedom",
    t2022D1: "Nationwide protests after the killing of Mahsa Amini",
    t2022D2: "Strong participation of women and youth",
    t2022D3: "Against coercion, repression, injustice",
    t2022D4: "Protests lasted nearly six months",
    t2022D5: "Hundreds killed, including children and teenagers",
    t2025Title: "Iran Sun and Lion National Revolution",
    t2025D1: "Began amid deep economic crisis, political repression, and erosion of public trust",
    t2025D2: "Rapidly expanded nationwide across multiple cities",
    t2025D3: "Peak of protests: January 8 and 9, following a call by Prince Reza Pahlavi",
    t2025D4: "Unofficial estimates: 20–30 million participants nationwide",
    t2025Death: "Estimated deaths: 43,000+",
    // Revolution
    revLabel: "Current Crisis",
    revTitle: "Iran Sun and Lion National Revolution",
    revSubtitle: "December 2025 to January 2026",
    revCallout: "In just 3 days, the Iranian regime killed more civilians than many of the worst massacres in modern history combined.",
    revStat1Num: "30M+",
    revStat1Label: "Estimated participants nationwide",
    revStat2Num: "43,000+",
    revStat2Label: "Estimated civilian deaths",
    revStat3Num: "~10",
    revStat3Label: "People killed every minute during peak violence",
    revSource: "Source: International Human Rights Report",
    chartTitle: "Scale of Violence — Massacres in History",
    blackoutTitle: "Near-Total Internet Blackout",
    blackoutDesc: "Authorities imposed a nationwide internet shutdown starting January 8 to conceal the true scale of atrocities. This is a key factor making independent death toll verification impossible.",
    detentionTitle: "Nationwide Shutdown and Repression",
    detentionD1: "Approximately 50,000 people arrested — many charged with \"moharebeh\" (waging war against God), which carries the death penalty",
    detentionD2: "Detainees reportedly subjected to torture, sexual assault, and injection of unknown substances linked to deaths in custody",
    detentionD3: "Reports indicate a high risk of heavy sentences and expedited executions",
    detentionD4: "Pressure on families and restrictions on information continue",
    // CTA
    ctaLabel: "Take Action",
    ctaTitle: "How You Can Support Us",
    ctaIntro: "Your voice matters. Every share, every conversation, every action makes a difference.",
    shareTwitter: "Share on X",
    shareFacebook: "Share on Facebook",
    shareCopyLink: "Copy Link",
    action1Title: "Contact Officials",
    action1Desc: "Contact Canadian and Quebec officials. Demand action against the regime and request the immediate release of prisoners in danger of execution.",
    action2Title: "Join Our Rally",
    action2Desc: "Join our rally in Montreal every weekend to show support and solidarity.",
    action3Title: "Speak Up",
    action3Desc: "Raise awareness with family and friends, and share verified information on social media (Instagram, X, Facebook, TikTok).",
    action4Title: "Install Conduit",
    action4Desc: "Help Iranians stay connected by installing Conduit on your device.",
    action5Title: "Demand Accountability",
    action5Desc: "Demand the deportation of IRGC officials' families from Canada.",
    action6Title: "Pass It On",
    action6Desc: "Read this, then pass it on. Be our voice.",
    ctaScan: "Scan for more info, daily updates, and protest schedule",
    ctaTelegram: "Join our Telegram group for collaboration and updates",
    ctaTelegramBtn: "Join ETS4IRAN on Telegram",
    // Footer
    footerAuthors: "Authors: A group of Iranian students at ÉTS, Montreal",
    footerDate: "January 2026",
  },
  fr: {
    // Nav
    navTimeline: "Chronologie",
    navHelp: "Aider",
    // Hero
    heroTitle1: "Soutenez le Peuple",
    heroTitle2: "d'Iran",
    heroFreedom: "Pour la Liberté",
    heroStatLabel: "civils tués en moins de 3 jours",
    heroQuote: "Ce n'est pas un conflit politique. C'est de la violence d'État contre des civils.",
    scrollText: "Défiler",
    // Iran & Its People
    iranLabel: "Qui Nous Sommes",
    iranTitle: "L'Iran et Son Peuple",
    iranP1: "L'Iran, anciennement connu sous le nom de Perse, est la plus ancienne civilisation continue au monde liée à un État moderne, avec plus de 5 000 ans d'histoire. Patrie de plus de 90 millions de personnes, l'Iran a façonné l'histoire humaine grâce à sa riche culture — exprimée dans une poésie, une musique, un art et une philosophie intemporels — laissant une empreinte durable sur la civilisation mondiale.",
    iranP2: "Les Perses sont réputés pour leur sens profond de l'hospitalité, leur chaleur et leur générosité. Ils sont communément associés à un mode de vie pacifique, patient et respectueux, valorisant le dialogue, la courtoisie et les liens humains.",
    hospitalityTitle: "Un Héritage de Compassion",
    hospitalityP: "Un exemple puissant de l'humanité du peuple iranien est l'accueil d'environ 116 000 à 120 000 réfugiés polonais pendant la Seconde Guerre mondiale. Ils sont arrivés en Iran et ont été hébergés et soignés avec compassion et dignité.",
    hospitalityCaption: "Réfugiés polonais en Iran, 1942",
    // Regime
    regimeLabel: "La Vérité",
    regimeTitle1: "République Islamique",
    regimeNe: "≠",
    regimeTitle2: "Iran",
    regimeP: "Alors que les Iraniens aspirent à la paix et au respect de la vie humaine, le gouvernement (Régime Islamique) ne représente pas ces valeurs. C'est un régime brutal et autoritaire fondé sur une idéologie extrême pour justifier la corruption et réprimer la volonté de son peuple.",
    regimeFact1: "Gouverne par la peur — utilisant les exécutions, la torture et la censure pour faire taire la dissidence",
    regimeFact2: "Cible systématiquement les femmes, les minorités et les militants",
    regimeFact3: "Exporte l'instabilité et la violence par le biais de milices et de réseaux extrémistes",
    regimeFact4: "Les politiques de ce régime ne représentent pas la culture, les valeurs ou le caractère de son peuple",
    // Diaspora
    diasporaLabel: "Ponts Entre les Nations",
    diasporaTitle: "Diaspora Iranienne & Canada",
    diasporaP1: "La diaspora iranienne au Canada s'est développée à travers plusieurs vagues d'immigration, façonnées par des événements politiques, sociaux et économiques. De nombreux Iraniens sont arrivés comme étudiants, professionnels qualifiés, entrepreneurs et réfugiés, contribuant de manière significative dans les domaines de l'ingénierie, la médecine, le milieu universitaire, les affaires et les arts.",
    diasporaP2: "Aujourd'hui, la communauté irano-canadienne est l'un des groupes diasporiques les plus éduqués et les plus engagés, profondément intégrée à la société canadienne. Les Iraniens au Québec parlent le persan (farsi) aux côtés du français et de l'anglais, contribuant à la vie culturelle, académique et économique du Québec tout en préservant fièrement leur identité culturelle vibrante.",
    canadaTitle: "Relations Iran-Canada",
    canadaP1: "Avant l'établissement de la République Islamique, les relations Iran-Canada étaient amicales, stables et constructives. Un moment notable fut la visite officielle de Mohammad Reza Shah Pahlavi, le Roi d'Iran, au Canada et au Québec en 1965.",
    canadaP2: "Les relations se sont détériorées après 1979. Le Canada a officiellement rompu ses relations diplomatiques avec l'Iran en 2012, invoquant de graves préoccupations concernant les violations des droits de l'homme et le soutien au terrorisme.",
    canadaCaption: "Le Shah d'Iran et son épouse en visite à Montréal, 1965. Source : Les Archives de la Ville de Montréal",
    futureVision: "Un Iran libre et démocratique peut reconstruire sa forte relation historique avec le Canada et ouvrir de nombreuses opportunités positives, y compris l'expansion du commerce et des investissements dans la technologie, l'agriculture et l'industrie, ainsi que la croissance du tourisme et des échanges culturels.",
    futureTitle: "Une Vision pour l'Avenir",
    // Timeline
    timelineLabel: "Histoire de la Résistance",
    timelineTitle: "Quatre Décennies de Protestation et de Répression en Iran",
    timelineIntro: "Depuis plus de 47 ans, les Iraniens endurent le régime islamique tout en luttant avec persistance et pacifiquement pour leurs droits fondamentaux.",
    // Timeline events
    t1979Title: "Manifestations des Femmes Contre le Hijab Obligatoire",
    t1979D1: "Première grande manifestation contre les politiques de la République Islamique",
    t1979D2: "Les femmes protestent contre le hijab obligatoire",
    t1979D3: "Réponse de l'État : répression et recul des droits des femmes",
    t1980Title: "Exécutions Massives de Prisonniers Politiques",
    t1980D1: "Années d'arrestations, d'exécutions, de purges politiques (1980–88)",
    t1980D2: "Des milliers exécutés en secret",
    t1980D3: "\"Tribunaux de 3 minutes\", aucun procès équitable",
    t1980Death: "Bilan : plus de 5 000 morts",
    t1980Memorial: "Classé comme crimes contre l'humanité par Human Rights Watch",
    t1999Title: "Mouvement Étudiant",
    t1999D1: "Manifestations contre les restrictions à la liberté d'expression et la censure de la presse",
    t1999D2: "Attaque violente contre les résidences universitaires",
    t1999D3: "Début de la répression directe contre les étudiants et les jeunes",
    t2009Title: "Mouvement Vert",
    t2009D1: "Manifestations massives après l'élection présidentielle contestée",
    t2009D2: "Des millions ont marché à travers le pays pour une manifestation pacifique",
    t2009D3: "Réponse de l'État : répression, arrestations, meurtres",
    t2009D4: "Les troubles ont continué pendant plus d'un an",
    t2017Title: "Manifestations Économiques Devenant Politiques",
    t2017D1: "Manifestations pour des revendications économiques",
    t2017D2: "Rapidement devenues anti-régime",
    t2017D3: "Réponse de l'État : violence extrême et répression",
    t2019Title: "Novembre Sanglant",
    t2019D1: "Manifestations contre la hausse du prix du carburant",
    t2019D2: "Brutalement réprimées par l'État",
    t2019D3: "Au moins 1 500 tués en quelques jours",
    t2019D4: "A approfondi le fossé entre le peuple et le régime",
    t2019Death: "Au moins 1 500 tués",
    t2020Title: "Abattage du Vol PS752",
    t2020D1: "Les Gardiens de la Révolution abattent le vol PS752 d'Ukraine International Airlines",
    t2020D2: "176 civils tués (55 Canadiens, 30 résidents permanents)",
    t2020D3: "Manifestations contre les mensonges et l'impunité de l'État",
    t2020D4: "Réponse de l'État : arrestations, intimidation, répression",
    t2020Death: "176 civils tués",
    t2022Title: "Femme, Vie, Liberté",
    t2022D1: "Manifestations nationales après le meurtre de Mahsa Amini",
    t2022D2: "Forte participation des femmes et des jeunes",
    t2022D3: "Contre la coercition, la répression, l'injustice",
    t2022D4: "Les manifestations ont duré près de six mois",
    t2022D5: "Des centaines de tués, dont des enfants et des adolescents",
    t2025Title: "Révolution Nationale du Soleil et du Lion d'Iran",
    t2025D1: "Début dans un contexte de crise économique profonde, de répression politique et d'érosion de la confiance publique",
    t2025D2: "Extension rapide à travers le pays dans de multiples villes",
    t2025D3: "Apogée des manifestations : 8 et 9 janvier, suite à l'appel du Prince Reza Pahlavi",
    t2025D4: "Estimations non-officielles : 20 à 30 millions de participants",
    t2025Death: "Estimations des décès : 43 000+",
    // Revolution
    revLabel: "Crise Actuelle",
    revTitle: "Révolution Nationale du Soleil et du Lion d'Iran",
    revSubtitle: "Décembre 2025 à Janvier 2026",
    revCallout: "En seulement 3 jours, le régime iranien a tué plus de civils que de nombreux pires massacres de l'histoire moderne réunis.",
    revStat1Num: "30M+",
    revStat1Label: "Participants estimés à travers le pays",
    revStat2Num: "43 000+",
    revStat2Label: "Décès civils estimés",
    revStat3Num: "~10",
    revStat3Label: "Personnes tuées chaque minute au pic de la violence",
    revSource: "Source : Rapport international des droits de l'homme",
    chartTitle: "Échelle de la Violence — Massacres dans l'Histoire",
    blackoutTitle: "Coupure Internet Quasi Totale",
    blackoutDesc: "Les autorités ont imposé une coupure internet à l'échelle nationale à partir du 8 janvier pour dissimuler l'ampleur réelle des atrocités. C'est un facteur clé rendant la vérification indépendante du bilan impossible.",
    detentionTitle: "Fermeture Nationale et Répression",
    detentionD1: "Environ 50 000 personnes arrêtées — beaucoup accusées de « moharebeh » (guerre contre Dieu), un crime passible de la peine de mort",
    detentionD2: "Les détenus seraient soumis à la torture, aux agressions sexuelles et à l'injection de substances inconnues liées à des décès en détention",
    detentionD3: "Les rapports indiquent un risque élevé de lourdes peines et d'exécutions expéditives",
    detentionD4: "La pression sur les familles et les restrictions d'information continuent",
    // CTA
    ctaLabel: "Agir",
    ctaTitle: "Comment Nous Soutenir",
    ctaIntro: "Votre voix compte. Chaque partage, chaque conversation, chaque action fait la différence.",
    shareTwitter: "Partager sur X",
    shareFacebook: "Partager sur Facebook",
    shareCopyLink: "Copier le Lien",
    action1Title: "Contacter les Élus",
    action1Desc: "Contactez les responsables canadiens et québécois. Exigez des mesures contre le régime et la libération immédiate des prisonniers en danger d'exécution.",
    action2Title: "Rejoindre Notre Rassemblement",
    action2Desc: "Rejoignez notre rassemblement à Montréal chaque week-end pour montrer votre soutien et solidarité.",
    action3Title: "Prenez la Parole",
    action3Desc: "Sensibilisez votre famille et vos amis, et partagez des informations vérifiées sur les réseaux sociaux (Instagram, X, Facebook, TikTok).",
    action4Title: "Installer Conduit",
    action4Desc: "Aidez les Iraniens à rester connectés en installant Conduit sur votre appareil.",
    action5Title: "Exiger des Comptes",
    action5Desc: "Demandez l'expulsion des familles des responsables des Gardiens de la Révolution du Canada.",
    action6Title: "Faites Passer le Message",
    action6Desc: "Lisez ceci, puis transmettez-le. Soyez notre voix.",
    ctaScan: "Scannez pour plus d'infos, mises à jour quotidiennes et horaire des manifestations",
    ctaTelegram: "Rejoignez notre groupe Telegram pour collaborer et rester informé",
    ctaTelegramBtn: "Rejoindre ETS4IRAN sur Telegram",
    // Footer
    footerAuthors: "Auteurs : Un groupe d'étudiants iraniens à l'ÉTS, Montréal",
    footerDate: "Janvier 2026",
  }
};

let currentLang = 'en';

function detectLanguage() {
  const saved = localStorage.getItem('ets4iran-lang');
  if (saved && (saved === 'en' || saved === 'fr')) return saved;
  const browserLang = navigator.language || navigator.userLanguage;
  return browserLang.startsWith('fr') ? 'fr' : 'en';
}

function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('ets4iran-lang', lang);
  document.documentElement.lang = lang;

  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (i18n[lang][key]) {
      el.textContent = i18n[lang][key];
    }
  });

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });

  updateShareLinks();
}

function updateShareLinks() {
  const pageUrl = window.location.href;
  const text = currentLang === 'fr'
    ? 'Soutenez le peuple iranien pour la liberté. Plus de 43 000 civils ont été tués. #ETS4IRAN #IranRevolution'
    : 'Stand with the people of Iran for freedom. Over 43,000 civilians killed. #ETS4IRAN #IranRevolution';

  const twitterBtn = document.querySelector('.share-btn.twitter');
  if (twitterBtn) {
    twitterBtn.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(pageUrl)}`;
  }

  const fbBtn = document.querySelector('.share-btn.facebook');
  if (fbBtn) {
    fbBtn.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`;
  }
}

function copyLink() {
  navigator.clipboard.writeText(window.location.href).then(() => {
    const btn = document.querySelector('.share-btn.copy-link');
    const label = btn.querySelector('span');
    if (!label) return;
    label.textContent = currentLang === 'fr' ? 'Copié !' : 'Copied!';
    setTimeout(() => {
      label.textContent = i18n[currentLang].shareCopyLink;
    }, 2000);
  });
}

function initMobileMenu() {
  const toggle = document.querySelector('.menu-toggle');
  const navLinks = document.querySelector('.nav-links');
  if (!toggle || !navLinks) return;

  toggle.addEventListener('click', () => {
    navLinks.classList.toggle('mobile-open');
    const isOpen = navLinks.classList.contains('mobile-open');
    toggle.setAttribute('aria-expanded', isOpen);
  });

  navLinks.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      navLinks.classList.remove('mobile-open');
      toggle.setAttribute('aria-expanded', 'false');
    });
  });
}

function initHeaderScroll() {
  const header = document.querySelector('.site-header');
  if (!header) return;

  window.addEventListener('scroll', () => {
    header.classList.toggle('scrolled', window.scrollY > 80);
  }, { passive: true });
}

function initAnimations() {
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    document.querySelectorAll('.reveal, .reveal-left, .reveal-right, .reveal-scale').forEach(el => {
      el.style.opacity = '1';
      el.style.transform = 'none';
    });
    return;
  }

  gsap.registerPlugin(ScrollTrigger);

  const heroTl = gsap.timeline({ delay: 0.3 });
  heroTl
    .from('.hero h1', { y: 60, opacity: 0, duration: 1, ease: 'power3.out' })
    .from('.hero .word-freedom', { y: 30, opacity: 0, duration: 0.8, ease: 'power3.out' }, '-=0.5')
    .from('.hero-stat', { y: 30, opacity: 0, duration: 0.8, ease: 'power3.out' }, '-=0.4')
    .from('.hero-quote', { y: 20, opacity: 0, duration: 0.8, ease: 'power3.out' }, '-=0.4')
    .from('.hero-images img', {
      y: 40, opacity: 0, duration: 0.6, stagger: 0.15, ease: 'power3.out'
    }, '-=0.3')
    .from('.scroll-indicator', { opacity: 0, duration: 0.6 }, '-=0.2');

  initCounter('.hero-stat .counter', 43000, '+', '', false, 1.8);

  ScrollTrigger.batch('.reveal', {
    start: 'top 85%',
    onEnter: batch => gsap.to(batch, { y: 0, opacity: 1, duration: 0.8, ease: 'power3.out', stagger: 0.1 }),
    once: true,
  });

  ScrollTrigger.batch('.reveal-left', {
    start: 'top 85%',
    onEnter: batch => gsap.to(batch, { x: 0, opacity: 1, duration: 0.8, ease: 'power3.out', stagger: 0.1 }),
    once: true,
  });

  ScrollTrigger.batch('.reveal-right', {
    start: 'top 85%',
    onEnter: batch => gsap.to(batch, { x: 0, opacity: 1, duration: 0.8, ease: 'power3.out', stagger: 0.1 }),
    once: true,
  });

  ScrollTrigger.batch('.reveal-scale', {
    start: 'top 85%',
    onEnter: batch => gsap.to(batch, { scale: 1, opacity: 1, duration: 0.8, ease: 'power3.out', stagger: 0.1 }),
    once: true,
  });

  const neSymbol = document.querySelector('.regime-title .ne');
  if (neSymbol) {
    gsap.set(neSymbol, { scale: 0, opacity: 0 });
    ScrollTrigger.create({
      trigger: '.regime-title',
      start: 'top 80%',
      once: true,
      onEnter: () => {
        gsap.to(neSymbol, {
          scale: 1,
          opacity: 1,
          duration: 1,
          ease: 'elastic.out(1.2, 0.4)',
          onComplete: () => neSymbol.classList.add('animated'),
        });
      }
    });
  }

  gsap.utils.toArray('.timeline-event').forEach((event, i) => {
    const content = event.querySelector('.event-content');
    const image = event.querySelector('.event-image');
    const isEven = i % 2 === 1;
    const isFinal = event.classList.contains('timeline-event-final');

    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: event,
        start: 'top 80%',
        toggleActions: 'play none none none',
      }
    });

    if (isFinal) {
      if (content) {
        tl.from(content, {
          scale: 0.85,
          opacity: 0,
          duration: 1,
          ease: 'power3.out'
        });
      }
      if (image) {
        tl.from(image, {
          scale: 0.85,
          opacity: 0,
          duration: 1,
          ease: 'power3.out'
        }, '-=0.7');
      }
    } else {
      if (content) {
        tl.from(content, {
          x: isEven ? 60 : -60,
          opacity: 0,
          duration: 0.8,
          ease: 'power3.out'
        });
      }
      if (image) {
        tl.to(image, {
          clipPath: 'inset(0 0% 0 0%)',
          duration: 1,
          ease: 'power3.inOut',
          onStart: () => image.classList.add('revealed'),
        }, '-=0.5');
      }
    }

  });

  initCounter('#stat1', 30, '', 'M+', true, 0);
  initCounter('#stat2', 43000, '', '+', true, 0.4);
  initCounter('#stat3', 10, '~', '', true, 0.8);

  initBarChart();

  gsap.to('.hero-bg img', {
    y: 100,
    ease: 'none',
    scrollTrigger: {
      trigger: '.hero',
      start: 'top top',
      end: 'bottom top',
      scrub: true,
    }
  });
}

function initCounter(selector, target, prefix, suffix, useScrollTrigger, delay) {
  const el = document.querySelector(selector);
  if (!el) return;

  const obj = { val: 0 };

  const anim = gsap.to(obj, {
    val: target,
    duration: 2,
    delay: delay || 0,
    ease: 'power2.out',
    paused: !!useScrollTrigger,
    onUpdate: () => {
      const formatted = target >= 1000
        ? Math.floor(obj.val).toLocaleString()
        : Math.floor(obj.val).toString();
      el.textContent = prefix + formatted + suffix;
    }
  });

  if (useScrollTrigger) {
    ScrollTrigger.create({
      trigger: el,
      start: 'top 85%',
      onEnter: () => anim.play(),
      once: true,
    });
  }
}

function initBarChart() {
  const chartSection = document.querySelector('.massacre-chart');
  if (!chartSection) return;

  const bars = chartSection.querySelectorAll('.chart-row-bar');

  ScrollTrigger.create({
    trigger: chartSection,
    start: 'top 75%',
    once: true,
    onEnter: () => {
      bars.forEach(bar => {
        const targetWidth = bar.dataset.width;
        gsap.to(bar, {
          width: targetWidth + '%',
          duration: 1.5,
          ease: 'power2.out',
          delay: parseFloat(bar.dataset.delay) || 0,
        });
      });
    }
  });
}

function initLenis() {
  if (typeof Lenis === 'undefined') return;

  const lenis = new Lenis({
    duration: 1.2,
    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
    smoothWheel: true,
  });

  if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
    lenis.on('scroll', ScrollTrigger.update);
    gsap.ticker.add((time) => lenis.raf(time * 1000));
    gsap.ticker.lagSmoothing(0);
  }

  return lenis;
}

function initScrollProgress() {
  const bar = document.querySelector('.scroll-progress');
  if (!bar) return;

  window.addEventListener('scroll', () => {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    bar.style.width = (scrollTop / docHeight * 100) + '%';
  }, { passive: true });
}

function initCurtainReveal() {
  const curtain = document.querySelector('.page-curtain');
  if (!curtain || typeof gsap === 'undefined') return;

  gsap.to(curtain, {
    opacity: 0,
    duration: 0.8,
    delay: 0.2,
    ease: 'power2.inOut',
    onComplete: () => {
      curtain.style.display = 'none';
    }
  });
}

function initParticles() {
  if (typeof tsParticles === 'undefined') return;

  tsParticles.load('revolution-particles', {
    fpsLimit: 60,
    particles: {
      number: { value: 30, density: { enable: true, area: 1000 } },
      color: { value: ['#E53935', '#D4A843', '#FF6B35'] },
      shape: { type: 'circle' },
      opacity: {
        value: { min: 0.1, max: 0.4 },
        animation: { enable: true, speed: 0.5, minimumValue: 0.05 }
      },
      size: {
        value: { min: 1, max: 3 },
        animation: { enable: true, speed: 1, minimumValue: 0.5 }
      },
      move: {
        enable: true,
        speed: { min: 0.3, max: 1 },
        direction: 'top',
        outModes: { default: 'out' },
        random: true,
      },
      life: {
        duration: { sync: false, value: { min: 3, max: 6 } },
        count: 0,
      }
    },
    detectRetina: true,
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const detectedLang = detectLanguage();
  setLanguage(detectedLang);

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
  });

  const copyBtn = document.querySelector('.share-btn.copy-link');
  if (copyBtn) {
    copyBtn.addEventListener('click', (e) => {
      e.preventDefault();
      copyLink();
    });
  }

  initMobileMenu();
  initHeaderScroll();
  initScrollProgress();
  initCurtainReveal();
  initLenis();

  if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
    initAnimations();
    ScrollTrigger.refresh();
  } else {
    window.addEventListener('load', () => {
      if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
        initAnimations();
        ScrollTrigger.refresh();
      }
    });
  }

  initFloatingCTA();
  initParticles();
});

function initFloatingCTA() {
  const floatingCta = document.querySelector('.floating-cta');
  const hero = document.querySelector('.hero');
  if (!floatingCta || !hero) return;

  const observer = new IntersectionObserver(([entry]) => {
    floatingCta.classList.toggle('visible', !entry.isIntersecting);
  }, { threshold: 0 });

  observer.observe(hero);
}
